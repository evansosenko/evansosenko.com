{{ $production := eq (getenv "HUGO_ENV") "production" | or (eq site.Params.env "production") }}

{{ $url := . }}
{{ if not $production }}
  {{ $url = replace $url ".min." "." }}
{{ end }}
{{ $asset := resources.GetRemote $url }}
{{ if $production }}
  {{ $asset = resources.Fingerprint $asset }}
{{ else }}
  {{ $content := $asset.Content |  }}
  {{ $target := path.Base $url }}
  {{ $asset = $asset.Content | resources.FromString $target }}
{{ end }}

{{ if strings.HasSuffix $asset.RelPermalink ".css" }}
  <link rel="stylesheet"
    {{ if $production }}integrity="{{ $asset.Data.Integrity }}"{{ end }}
    href="{{ $asset.RelPermalink }}">
{{ end }}

{{ if strings.HasSuffix $asset.RelPermalink ".js" }}
  <script
    async
    src="{{ $asset.RelPermalink }}"
    {{ if $production }}integrity="{{ $asset.Data.Integrity }}"{{ end }}
    crossorigin="anonymous">
  </script>
{{ end }}


{{ if not $production }}
  {{ if strings.HasSuffix $asset.RelPermalink ".map" }}
    {{ $asset.Publish }}
  {{ end }}
{{ end }}
